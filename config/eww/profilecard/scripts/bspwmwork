#!/bin/bash

# Create named pipe for communication
PIPE="/tmp/eww_workspaces.pipe"
rm -f "$PIPE"
mkfifo "$PIPE"

# Function to get workspace states
get_workspaces() {
    bspc wm -g | awk -F: '{
        for(i=1; i<=NF; i++) {
            if($i != "") {
                desktop = substr($i,1,1)
                state = "empty"
                if(index($i,"F") > 0) state = "current"
                else if(index($i,"O") > 0) state = "occupied"
                print desktop ":" state
            }
        }
    }'
}

# Initial state
get_workspaces

# Update on changes
bspc subscribe report | while read -r line; do
    get_workspaces
done > "$PIPE" &
